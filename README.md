# monitor-b
# monitor-b


# π›οΈ M32 USB μ¤λ””μ¤ μ†΅μ¶ μ‹μ¤ν… β€” μµμΆ… μ”κµ¬μ‚¬ν•­ μ¤ν™

---

## π“‹ κ°μ”
Midas M32μ USB λ©€ν‹°μ±„λ„ μ¤λ””μ¤λ¥Ό μΊ΅μ²ν•΄ Wi-Fiλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈ(μ•λ“λ΅μ΄λ“ + iOS)λ΅ μ €μ§€μ—° μ†΅μ¶.  
ν΄λΌμ΄μ–ΈνΈλ” κ° μ±„λ„μ„ λ΅μ»¬μ—μ„ λ―Ήμ‹±ν•λ©°, κ°μΈ μ„¤μ •μ„ μ €μ¥ν•κ³  μµμ‹  ν¨ν‚·μ„ μ¬μƒν•λ‹¤.

---

## π― μ‹μ¤ν… κµ¬μ„±

### π”· μ„λ²„
- λ¦¬λ…μ¤ μ„λ²„ (Rust λ°±μ—”λ“ + FastAPI μ›Ή UI)
- M32 USB μ—°κ²° (32μ±„λ„ μ¤λ””μ¤ μΊ΅μ²)
- UDP/RTPλ΅ 32μ±„λ„ μ†΅μ¶
- μ„¤μ •μ€ JSON/YAML νμΌλ΅ κ΄€λ¦¬
- μ›Ή UIμ—μ„ μ±„λ„ μ΄λ¦„, μ¤λ””μ¤ ν¬λ§· λ“± μ„¤μ • κ°€λ¥ (λΉ„λ°€λ²νΈ λ³΄νΈ)
- μ—λ¬ λ΅κΉ…
- λ„¤νΈμ›ν¬ ν’μ§ λ¨λ‹ν„°λ§ (μ†μ‹¤λ¥ /μ§€ν„°/μ§€μ—°)

### π”· ν΄λΌμ΄μ–ΈνΈ
- μ•λ“λ΅μ΄λ“ + iOS μ•±
- UDP/RTPλ΅ 32μ±„λ„ μμ‹ 
- λ΅μ»¬μ—μ„ λ―Ήμ‹± λ° μ¬μƒ
- κ°μΈ μ„¤μ •μ€ λ΅μ»¬μ— μ €μ¥
- μµμ‹  ν¨ν‚·λ§ μ¬μƒ (μ§€μ—° μµμ†ν™”)
- μ„λ²„μ μƒν”λ μ΄νΈ/μ½”λ± λ³€κ²½ μ‹ μλ™ μ¬μ—°κ²°

### π”· λ„¤νΈμ›ν¬
- μ „μ© 5GHz AP
- μ λ‹μΊμ¤νΈ UDP
- ν΄λΌμ΄μ–ΈνΈ μµλ€ 20λ…
- NTP λ™κΈ°ν™”

---

## π“΅ ν΄λΌμ΄μ–ΈνΈ β†” μ„λ²„ μ—°κ²°

### μ¤λ””μ¤ λ°μ΄ν„°
| νΉμ„± | λ‚΄μ© |
|------|------|
| ν”„λ΅ν† μ½ | UDP + RTP |
| λ°©ν–¥ | μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ |
| ν¬νΈ | κ³ μ • UDP ν¬νΈ (μ: 5004) |
| λ°μ΄ν„° | 32μ±„λ„ λ©€ν‹°μ±„λ„ μ¤λ””μ¤ |

### λ©”νƒ€λ°μ΄ν„°
| νΉμ„± | λ‚΄μ© |
|------|------|
| ν”„λ΅ν† μ½ | HTTP (REST API) |
| λ°©ν–¥ | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ |
| ν¬νΈ | HTTP ν¬νΈ (μ: 8000) |
| λ°μ΄ν„° | μ±„λ„ μ΄λ¦„/λ²νΈ/μ†μ„±, μ„λ²„ μƒνƒ, λ„¤νΈμ›ν¬ ν’μ§ |

---

## π›°οΈ μ„λ²„ νƒμƒ‰ λ°©λ²•

ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„μ IPλ¥Ό μ•μ•„λ‚΄λ” λ°©λ²•:
β… **mDNS (μ°μ„ )**  
β… **QR μ½”λ“ (λ€μ•)**  
β… **μλ™ μ…λ ¥ (λ§μ§€λ§‰ μλ‹¨)**

### mDNS
- μ„λ²„κ°€ `m32-server.local` λ΅ mDNS λΈλ΅λ“μΊμ¤νΈ
- ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬μ—μ„ μ΄λ¦„μΌλ΅ νƒμƒ‰

### QR μ½”λ“
- μ„λ²„ μ›Ή UIμ—μ„ QR μ½”λ“ ν‘μ‹ (`m32-server.local` λλ” ν„μ¬ IP)
- ν΄λΌμ΄μ–ΈνΈκ°€ μΉ΄λ©”λΌλ΅ μ¤μΊ”ν•΄ μ„¤μ •

### μλ™ μ…λ ¥
- ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ IPλ¥Ό μ§μ ‘ μ…λ ¥
- μ•±μ—μ„ μ €μ¥ν•΄ μ‚¬μ©

---

## π€ ν΄λΌμ΄μ–ΈνΈ μ—°κ²° νλ¦„

1οΈβƒ£ ν΄λΌμ΄μ–ΈνΈκ°€ mDNSλ΅ `m32-server.local` νƒμƒ‰  
2οΈβƒ£ μ‹¤ν¨ μ‹ QR μ½”λ“ μ¤μΊ”  
3οΈβƒ£ κ·Έλλ„ μ‹¤ν¨ν•λ©΄ μλ™ μ…λ ¥  
4οΈβƒ£ RESTλ΅ λ©”νƒ€λ°μ΄ν„° μ”μ²­ β†’ UDPλ΅ μ¤λ””μ¤ μμ‹ 

---

## π›οΈ ν΄λΌμ΄μ–ΈνΈ μ±„λ„λ³„ μ„¤μ •

| μ†μ„± | νƒ€μ… | μ„¤λ… |
|------|------|-------|
| `id` | int | M32 USB μ±„λ„ λ²νΈ (1~32) |
| `name` | string | μ±„λ„ μ΄λ¦„ |
| `mute` | bool | μμ†κ±° |
| `hidden` | bool | UI μ¨κΉ€ |
| `order` | int | UI ν‘μ‹ μμ„ |
| `volume` | float | λ³Όλ¥¨ (0.0~1.0 or dB) |
| `solo` | bool | μ†”λ΅ |
| `pan` | float | μΆ/μ° λ°Έλ°μ¤ (-1.0~+1.0) |
| `eq` | object | EQ (low/mid/high) |
| `limit` | object/bool | λ¦¬λ―Έν„° (on/off + μ„¤μ •) |

### `eq` μμ‹
```json
"eq": {
  "low": -3.0,
  "mid": 0.0,
  "high": +2.5
}

```

---

## ποΈ μ¤λ””μ¤ μ†΅μ¶ λ©”νƒ€λ°μ΄ν„° (μ••μ¶•/μƒν”λ μ΄νΈ)

- μ„λ²„λ” μ¤λ””μ¤ RTP μ†΅μ¶ μ‹ **μ••μ¶• λ°©μ‹(compression)**, **μƒν”λ μ΄νΈ(sample_rate)** μ •λ³΄λ¥Ό μ„¤μ • νμΌ(config.yaml)λ΅ κ΄€λ¦¬ν•©λ‹λ‹¤.
- μμ‹ μ„¤μ •:
  ```yaml
  compression: "none"   # λλ” "opus", "aac" λ“±
  sample_rate: 48000     # λ‹¨μ„: Hz
  ```
- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ REST API(`/status` λλ” `/audio-meta` λ“±)λ΅ ν•΄λ‹Ή μ •λ³΄λ¥Ό λ¨Όμ € μ΅°νν•΄μ•Ό ν•©λ‹λ‹¤.
- μμ‹ μ‘λ‹µ:
  ```json
  {
    "status": "ok",
    "compression": "none",
    "sample_rate": 48000,
    "channels": 32
  }
  ```
- ν΄λΌμ΄μ–ΈνΈλ” μ΄ μ •λ³΄λ¥Ό λ°”νƒ•μΌλ΅ RTP μ¤νΈλ¦Όμ„ μ¬λ°”λ¥΄κ² λ””μ½”λ”©/μ¬μƒν•΄μ•Ό ν•©λ‹λ‹¤.
- μ„λ²„μ μƒν”λ μ΄νΈμ™€ ν΄λΌμ΄μ–ΈνΈκ°€ μ›ν•λ” μƒν”λ μ΄νΈκ°€ λ‹¤λ¥Ό κ²½μ°, μ„λ²„μ—μ„ λ¦¬μƒν”λ§μ„ μ μ©ν•  μ μμµλ‹λ‹¤.

---

## π›°οΈ μ¤λ””μ¤ RTP μ†΅μ¶ λ°©μ‹ (Unicast)

- μ„λ²„λ” **ν΄λΌμ΄μ–ΈνΈμ IP/ν¬νΈλ΅ μ§μ ‘ RTP(UDP) ν¨ν‚·μ„ μ†΅μ¶**ν•©λ‹λ‹¤.
- λ©€ν‹°μΊμ¤νΈκ°€ μ•„λ‹, λ‹¨μΌ ν΄λΌμ΄μ–ΈνΈ(νΉμ€ μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈ κ°κ°)μ— unicastλ΅ μ „μ†΅ν•©λ‹λ‹¤.
- λ©μ μ§€ IP/ν¬νΈλ” μ„λ²„ μ‹¤ν–‰ μ‹ ν™κ²½λ³€μλ΅ μ§€μ •ν•©λ‹λ‹¤.

### ν™κ²½λ³€μ μμ‹
- `RTP_DEST_IP` : RTP ν¨ν‚·μ„ λ°›μ„ ν΄λΌμ΄μ–ΈνΈμ IP μ£Όμ† (μ: `192.168.0.101`)
- `RTP_DEST_PORT` : RTP ν¬νΈ (μ: `5004`)

### μ‹¤ν–‰ μμ‹
```sh
RTP_DEST_IP=192.168.0.101 RTP_DEST_PORT=5004 cargo run --bin backend
```

- μ—¬λ¬ ν΄λΌμ΄μ–ΈνΈμ— μ†΅μ¶ν•λ ¤λ©΄, μ„λ²„μ—μ„ κ° ν΄λΌμ΄μ–ΈνΈ IP/ν¬νΈλ΅ λ°λ³µ μ†΅μ¶ν•λ„λ΅ ν™•μ¥ν•  μ μμµλ‹λ‹¤.

---

## π”„ ν΄λΌμ΄μ–ΈνΈ-μ„λ²„ μ—°λ™ μ‹λ‚λ¦¬μ¤

1. **ν΄λΌμ΄μ–ΈνΈλ” mDNS λλ” μλ™ μ…λ ¥μΌλ΅ μ„λ²„μ IPλ¥Ό μ–»λ”λ‹¤.**
2. **ν΄λΌμ΄μ–ΈνΈκ°€ μ„λ²„ IPμ— μμ›(μ¤λ””μ¤ μ¤νΈλ¦Ό) μ”μ²­μ„ λ³΄λ‚Έλ‹¤.**
   - (μ: REST APIλ΅ `/request-audio` λ“±)
3. **μ„λ²„λ” μ”μ²­ν• ν΄λΌμ΄μ–ΈνΈμ IPλ΅ RTP(UDP) μ¤λ””μ¤ μ¤νΈλ¦Όμ„ μ „μ†΅ν•λ‹¤.**
4. **ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ— heartbeat(μ£ΌκΈ°μ  μ‹ νΈ)λ¥Ό μ „μ†΅ν•μ—¬ μ¤νΈλ¦Ό μ „μ†΅μ„ μ μ§€ν•λ‹¤.**
   - (μ: REST APIλ΅ `/heartbeat` λ“±)
5. **μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈλ΅λ¶€ν„° 30μ΄ λ™μ• heartbeatκ°€ μ¤μ§€ μ•μΌλ©΄ RTP μ „μ†΅μ„ μ¤‘λ‹¨ν•λ‹¤.**

- μ΄ κµ¬μ΅°λ΅, ν΄λΌμ΄μ–ΈνΈκ°€ λ„¤νΈμ›ν¬λ¥Ό μ΄νƒν•κ±°λ‚ μ•±μ΄ μΆ…λ£λμ–΄λ„ μ„λ²„κ°€ μλ™μΌλ΅ μ†΅μ¶μ„ μ¤‘λ‹¨ν•  μ μμµλ‹λ‹¤.
- heartbeat μ£ΌκΈ°λ” 5~10μ΄ λ“±μΌλ΅ μ΅°μ • κ°€λ¥ν•λ©°, μ„λ²„/ν΄λΌμ΄μ–ΈνΈ λ¨λ‘ κµ¬ν„ ν•„μ”
