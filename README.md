
# M32 USB μ¤λ””μ¤ μ†΅μ¶ μ‹μ¤ν… β€” μµμ‹  μ”κµ¬μ‚¬ν•­ μ¤ν™

## κ°μ”

Midas M32μ USB λ©€ν‹°μ±„λ„ μ¤λ””μ¤λ¥Ό μΊ΅μ²ν•΄ Wi-Fiλ¥Ό ν†µν•΄ ν΄λΌμ΄μ–ΈνΈ(μ•λ“λ΅μ΄λ“ + iOS)λ΅ μ €μ§€μ—° μ†΅μ¶ν•λ‹¤.  
ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„κ°€ λ§¤ν•‘ν• μ±„λ„λ§ μμ‹ ν•μ—¬ λ΅μ»¬μ—μ„ λ―Ήμ‹±ν•κ³ , κ°μΈ μ„¤μ •μ„ μ €μ¥ν•λ©°, μµμ‹  ν¨ν‚·λ§ μ¬μƒν•λ‹¤.

## μ‹μ¤ν… κµ¬μ„±

### μ„λ²„

- λ¦¬λ…μ¤ μ„λ²„ (Rust λ°±μ—”λ“ + FastAPI μ›Ή UI)
- M32 USB μ—°κ²° (32μ±„λ„ μ¤λ””μ¤ μΊ΅μ²)
- UDP/RTPλ΅ λ§¤ν•‘λ μ±„λ„ μ†΅μ¶
- μ„¤μ •μ€ SQLiteλ΅ κ΄€λ¦¬
- μ΄λ²¤νΈ λ° ν΄λΌμ΄μ–ΈνΈ μƒνƒ ν†µμ‹ μ€ WebSocket μ‚¬μ©
- μ›Ή UIμ—μ„ μ±„λ„ μ΄λ¦„, μ¤λ””μ¤ ν¬λ§·, μ†΅μ¶ λ§¤ν•‘ μ„¤μ • κ°€λ¥ (λΉ„λ°€λ²νΈ λ³΄νΈ)
  - DAWλ΅λ¶€ν„° μμ‹ ν• 32μ±„λ„ μ¤‘ μ†΅μ¶ μ—¬λ¶€μ™€ μμ„ μ§€μ •
  - μ±„λ„ μ΄λ¦„ κΈ°λ³Έκ°’μ€ `CH01`, `CH02` β€¦
- ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„¤μ • λ³€κ²½ λ¶κ°€
- μ†΅μ¶ μ¤‘ μ„¤μ • λ³€κ²½ μ‹ μ„λ²„λ” μ„Έμ…μ„ μΆ…λ£ν•κ³  ν΄λΌμ΄μ–ΈνΈμ— μ•λ¦Ό
- μ—λ¬ λ΅κΉ…
- λ„¤νΈμ›ν¬ ν’μ§ λ¨λ‹ν„°λ§ (μ†μ‹¤λ¥ , μ§€ν„°, μ§€μ—°)

### ν΄λΌμ΄μ–ΈνΈ

- μ•λ“λ΅μ΄λ“ + iOS μ•±
- UDP/RTPλ΅ μ„λ²„κ°€ λ§¤ν•‘ν• μ±„λ„ μμ‹ 
- WebSocketμΌλ΅ μƒνƒ, μ„¤μ •, μ΄λ²¤νΈ μ†΅μμ‹ 
- λ΅μ»¬ λ―Ήμ‹± λ° μ¬μƒ
- λ΅μ»¬μ— κ°μΈ μ„¤μ • μ €μ¥
  - μ±„λ„λ³„ μ΄λ¦„, μƒ‰μƒ, μ΄λ―Έμ§€, λ³Όλ¥¨, ν¬, EQ, λ®¤νΈ, μƒν”λ μ΄νΈ, μ••μ¶• λ¨λ“
- μµμ‹  ν¨ν‚·λ§ μ¬μƒ
- μ„λ²„μ μƒν”λ μ΄νΈ/μ½”λ± λ³€κ²½ μ‹ μλ™ μ¬μ—°κ²°

## λ„¤νΈμ›ν¬

- μ „μ© 5GHz AP
- μ λ‹μΊμ¤νΈ UDP + WebSocket
- ν΄λΌμ΄μ–ΈνΈ μµλ€ 20λ…
- NTP λ™κΈ°ν™”
- UDP DSCP (QoS) μ„¤μ • κ°€λ¥ (μ: EF 46)

## μ¤λ””μ¤ λ°μ΄ν„°

| ν•­λ© | λ‚΄μ© |
|------|------|
| ν”„λ΅ν† μ½ | UDP + RTP |
| λ°©ν–¥ | μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ |
| ν¬νΈ | κ³ μ • UDP ν¬νΈ (μ: 5004) |
| λ°μ΄ν„° | λ§¤ν•‘λ μ±„λ„ μ¤λ””μ¤ λ°μ΄ν„° |
| μ†΅μ¶ μ΅°κ±΄ | ν΄λΌμ΄μ–ΈνΈκ°€ WebSocketμΌλ΅ client-config μ „λ‹¬ ν›„ |
| ν΄λΌμ΄μ–ΈνΈ heartbeat μ μ§€ |
| μ„λ²„λ” 30μ΄ μ΄μƒ heartbeat μ—†μΌλ©΄ μ†΅μ¶ μ¤‘λ‹¨ |

## λ©”νƒ€λ°μ΄ν„°

| ν•­λ© | λ‚΄μ© |
|------|------|
| ν”„λ΅ν† μ½ | HTTP (REST) |
| λ°©ν–¥ | ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ |
| λ°μ΄ν„° | μ±„λ„ μ΄λ¦„/λ²νΈ/μ†μ„±, μ„λ²„ μƒνƒ, λ„¤νΈμ›ν¬ ν’μ§ |
| `/audio-meta` | ν„μ¬ μƒν”λ μ΄νΈ, μ±„λ„ μ •λ³΄ ν™•μΈ |

## μ„λ²„ νƒμƒ‰ λ°©λ²•

- mDNS: `m32-server.local` νƒμƒ‰
- QR μ½”λ“: μ›Ή UIμ—μ„ ν‘μ‹λ QRμ½”λ“ μ¤μΊ”
- μλ™ μ…λ ¥: ν΄λΌμ΄μ–ΈνΈμ—μ„ μ§μ ‘ IP μ…λ ¥

## ν΄λΌμ΄μ–ΈνΈ β†” μ„λ²„ μ—°κ²° νλ¦„

1. ν΄λΌμ΄μ–ΈνΈκ°€ mDNS, QR μ½”λ“, μλ™ μ…λ ¥μΌλ΅ μ„λ²„ IP νƒμƒ‰
2. WebSocketμ„ μ—΄μ–΄ μƒνƒ ν†µμ‹  μ‹μ‘
3. `/request-audio?udp_port=ν¬νΈ` μ”μ²­
4. `client-config`λ¥Ό WebSocketμΌλ΅ μ „μ†΅
5. μ„λ²„κ°€ UDP μ†΅μ¶ μ‹μ‘
6. ν΄λΌμ΄μ–ΈνΈκ°€ μ£ΌκΈ°μ μΌλ΅ heartbeat μ „μ†΅
7. μ„λ²„κ°€ μ΄λ²¤νΈ λ°μƒ μ‹ WebSocketμΌλ΅ μ•λ¦Ό
8. ν΄λΌμ΄μ–ΈνΈκ°€ `/audio-meta` νΈμ¶ ν›„ μ¬μ—°κ²°

## ν΄λΌμ΄μ–ΈνΈ μ±„λ„λ³„ μ„¤μ •

| μ†μ„± | νƒ€μ… | μ„¤λ… |
|------|------|------|
| id | int | USB μ±„λ„ λ²νΈ |
| name | string | μ±„λ„ μ΄λ¦„ |
| mute | bool | μμ†κ±° |
| hidden | bool | UI μ¨κΉ€ |
| order | int | UI μμ„ |
| volume | float | λ³Όλ¥¨ |
| solo | bool | μ†”λ΅ |
| pan | float | μΆ/μ° λ°Έλ°μ¤ |
| eq | object | EQ |
| limit | object/bool | λ¦¬λ―Έν„° |

### EQ μμ‹

```json
"eq": {
  "low": -3.0,
  "mid": 0.0,
  "high": +2.5
}
```

## WebSocket λ©”μ‹μ§€ μμ‹

### ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„

#### heartbeat

```json
{
  "type": "heartbeat",
  "timestamp": "2025-07-15T10:05:00Z"
}
```

#### client-config

```json
{
  "type": "client_config",
  "payload": {
    "channels": [
      { "id": 1, "name": "Vocal", "mute": false }
    ],
    "sample_rate": 44100,
    "compression": "opus"
  }
}
```

### μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ

#### μ΄λ²¤νΈ λ©”μ‹μ§€

```json
{
  "type": "event",
  "payload": {
    "type": "config_changed",
    "reason": "latency too high, lowering sample rate",
    "new_sample_rate": 32000
  }
}
```

#### κΈ°νƒ€ μ΄λ²¤νΈ

| type | μ„¤λ… |
|------|------|
| reconnect | μ„λ²„ μ¬μ‹μ‘ ν•„μ” |
| config_changed | μ„¤μ • λ³€κ²½λ¨ |
| server_shutdown | μ„λ²„ μΆ…λ£ μμ • |
| network_warning | μ†μ‹¤/μ§€μ—°/μ§€ν„° κ²½κ³  |
| custom_message | μ‚¬μ©μ μ •μ λ©”μ‹μ§€ |

## λ™μ  μƒν”λ μ΄νΈ λ³€κ²½

- μ„λ²„λ” latencyλ¥Ό λ¨λ‹ν„°λ§ν•μ—¬ μ„κ³„μΉλ¥Ό μ΄κ³Όν•λ©΄ μƒν”λ μ΄νΈλ¥Ό λ‚®μ¶λ‹¤.
- ν΄λΌμ΄μ–ΈνΈμ— `config_changed` μ΄λ²¤νΈλ¥Ό WebSocketμΌλ΅ μ „μ†΅.
- ν΄λΌμ΄μ–ΈνΈλ” `/audio-meta`λ¥Ό νΈμ¶ν•΄ μƒ μƒν”λ μ΄νΈλ¥Ό ν™•μΈν•κ³  μ¬μ—°κ²°.
- μƒ μƒν”λ μ΄νΈλ” SQLiteμ— κΈ°λ΅.

### μƒν”λ μ΄νΈ λ‹¨κ³„ μμ‹

| λ‹¨κ³„ | μƒν”λ μ΄νΈ (Hz) |
|------|----------------|
| κΈ°λ³Έ | 48000 |
| λ‹¨κ³„ 1 | 44100 |
| λ‹¨κ³„ 2 | 32000 |
| λ‹¨κ³„ 3 | 24000 |

### SQLite μμ‹

```sql
UPDATE audio_config
SET sample_rate = 32000
WHERE active = 1;
```

## μ¤λ””μ¤ λ°μ΄ν„° μ²λ¦¬

- ν΄λΌμ΄μ–ΈνΈ μ—°κ²° μ‹μ—λ§ μ¤λ””μ¤ λ°μ΄ν„° μƒμ„± ν›„ μ†΅μ¶.
- ν΄λΌμ΄μ–ΈνΈκ°€ λ¨λ‘ λκΈ°λ©΄ λ°μ΄ν„° μƒμ„±/μ†΅μ¶ μ¤‘λ‹¨.
- λ²„νΌλ‚ μ €μ¥ μ—†μ΄ μ‹¤μ‹κ°„ μ†΅μ¶.
- ν…μ¤νΈ λ¨λ“μ—μ„λ” κ° μ±„λ„μ κ°’μ΄ μ±„λ„ λ²νΈμ™€ μΌμΉν•λ„λ΅ μ†΅μ¶ν•μ—¬ κ²€μ¦ κ°€λ¥.

## μ”μ•½

- μμ› λ°μ΄ν„°: UDP + RTP μ†΅μ¶
- μƒνƒ/μ΄λ²¤νΈ: WebSocket
- μ„¤μ •: SQLite
- λ„¤νΈμ›ν¬ ν’μ§μ— λ”°λΌ μ„λ²„κ°€ μƒν”λ μ΄νΈλ¥Ό λ‚®μ¶ μ μμΌλ©°, ν΄λΌμ΄μ–ΈνΈλ” μ¬μ—°κ²°
- ν΄λΌμ΄μ–ΈνΈλ” μµμ‹  ν¨ν‚·λ§ μ¬μƒν•κ³  λ΅μ»¬ μ„¤μ •μΌλ΅ λ―Ήμ‹±
- QoS(Differentiated Services) μ„¤μ • κ°€λ¥

## π§ QoS ν…μ¤νΈ (λ‹¤μ ν΄λΌμ΄μ–ΈνΈ)

### λ‹¤μ ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰

- **λ™μ‹ μ ‘μ† ν…μ¤νΈ**: μ—¬λ¬ κ°μ test-clientλ¥Ό λ™μ‹μ— μ‹¤ν–‰ν•μ—¬ μ„λ²„μ λ‹¤μ¤‘ ν΄λΌμ΄μ–ΈνΈ μ²λ¦¬ λ¥λ ¥μ„ ν…μ¤νΈ
- **λ„¤νΈμ›ν¬ ν’μ§ λ¨λ‹ν„°λ§**: κ° ν΄λΌμ΄μ–ΈνΈλ³„ ν¨ν‚· μ†μ‹¤λ¥ , μ§€ν„°, μ§€μ—° μ‹κ°„ μΈ΅μ •
- **λ¶€ν• ν…μ¤νΈ**: ν΄λΌμ΄μ–ΈνΈ μλ¥Ό μ μ§„μ μΌλ΅ μ¦κ°€μ‹μΌ μ„λ²„ μ„±λ¥ ν•κ³„ ν™•μΈ

### ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ λ°©λ²•

#### 1. λ‹¨μΌ ν΄λΌμ΄μ–ΈνΈ (κΈ°λ³Έ)
```bash
cd test-client
cargo run
```

#### 2. λ‹¤μ ν΄λΌμ΄μ–ΈνΈ (QoS ν…μ¤νΈ)
```bash
# ν„°λ―Έλ„ 1
cd test-client
cargo run

# ν„°λ―Έλ„ 2 (λ‹¤λ¥Έ UDP ν¬νΈ μ‚¬μ©)
cd test-client
UDP_PORT=5005 cargo run

# ν„°λ―Έλ„ 3 (λ λ‹¤λ¥Έ UDP ν¬νΈ)
cd test-client
UDP_PORT=5006 cargo run
```

#### 3. μλ™ν™”λ λ‹¤μ ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰ μ¤ν¬λ¦½νΈ
```bash
#!/bin/bash
# test-multiple-clients.sh
for i in {1..5}; do
    UDP_PORT=$((5004 + i)) cargo run &
    echo "Started client $i on port $((5004 + i))"
    sleep 2
done
wait
```

### ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈ μ„¤μ •

#### ν™κ²½λ³€μ μ„¤μ •
ν…μ¤νΈ ν΄λΌμ΄μ–ΈνΈλ” ν™κ²½λ³€μλ¥Ό ν†µν•΄ λ‹¤μ–‘ν• μ„¤μ •μ„ μ΅°μ •ν•  μ μμµλ‹λ‹¤:

```bash
# UDP ν¬νΈ μ„¤μ • (κΈ°λ³Έκ°’: 5004)
export UDP_PORT=5005

# κ°•μ  μ§€μ—° μ„¤μ • (λ°€λ¦¬μ΄, κΈ°λ³Έκ°’: 0)
export FORCE_DELAY_MS=100

# ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰
cargo run
```

#### κ°•μ  μ§€μ—° κΈ°λ¥
- `FORCE_DELAY_MS`: RTP ν¨ν‚· μμ‹  ν›„ μ²λ¦¬ μ „μ— κ°•μ λ΅ μ§€μ—°μ„ μ¶”κ°€
- λ„¤νΈμ›ν¬ μ§€μ—° μ‹λ®¬λ μ΄μ…μ— μ‚¬μ©
- QoS ν…μ¤νΈ μ‹ λ‹¤μ–‘ν• μ§€μ—° μ΅°κ±΄μ—μ„μ λ™μ‘ ν™•μΈ κ°€λ¥

#### μ‚¬μ© μμ‹
```bash
# μ§€μ—° μ—†λ” κΈ°λ³Έ μ‹¤ν–‰
cargo run

# 50ms μ§€μ—°μΌλ΅ μ‹¤ν–‰
FORCE_DELAY_MS=50 cargo run

# λ‹¤λ¥Έ ν¬νΈ + 100ms μ§€μ—°μΌλ΅ μ‹¤ν–‰
UDP_PORT=5005 FORCE_DELAY_MS=100 cargo run

# λ‹¤μ ν΄λΌμ΄μ–ΈνΈ + λ‹¤μ–‘ν• μ§€μ—°μΌλ΅ ν…μ¤νΈ
FORCE_DELAY_MS=0 cargo run &    # ν΄λΌμ΄μ–ΈνΈ 1: μ§€μ—° μ—†μ
FORCE_DELAY_MS=50 cargo run &   # ν΄λΌμ΄μ–ΈνΈ 2: 50ms μ§€μ—°
FORCE_DELAY_MS=100 cargo run &  # ν΄λΌμ΄μ–ΈνΈ 3: 100ms μ§€μ—°
```

#### μ§€μ—° μ‹λ®¬λ μ΄μ… μ‹λ‚λ¦¬μ¤
- **μ •μƒ λ„¤νΈμ›ν¬**: `FORCE_DELAY_MS=0` (κΈ°λ³Έκ°’)
- **μ•½κ°„μ μ§€μ—°**: `FORCE_DELAY_MS=10-50`
- **μ¤‘κ°„ μ§€μ—°**: `FORCE_DELAY_MS=50-100`
- **λ†’μ€ μ§€μ—°**: `FORCE_DELAY_MS=100-500`
- **λ§¤μ° λ†’μ€ μ§€μ—°**: `FORCE_DELAY_MS=500+`

### QoS ν…μ¤νΈ ν•­λ©

| ν…μ¤νΈ ν•­λ© | μ„¤λ… | μΈ΅μ • λ°©λ²• |
|------------|------|-----------|
| **λ™μ‹ μ ‘μ† μ** | μ„λ²„κ°€ μ²λ¦¬ν•  μ μλ” μµλ€ ν΄λΌμ΄μ–ΈνΈ μ | ν΄λΌμ΄μ–ΈνΈ μλ¥Ό μ μ§„μ μΌλ΅ μ¦κ°€ |
| **ν¨ν‚· μ†μ‹¤λ¥ ** | RTP ν¨ν‚· μ „μ†΅ μ¤‘ μ†μ‹¤λ ν¨ν‚· λΉ„μ¨ | ν΄λΌμ΄μ–ΈνΈμ—μ„ μμ‹  ν¨ν‚· μ vs μμƒ ν¨ν‚· μ |
| **μ§€ν„° (Jitter)** | ν¨ν‚· κ°„ λ„μ°© μ‹κ°„ λ³€λ™ | RTP νƒ€μ„μ¤νƒ¬ν”„ κΈ°λ° κ³„μ‚° |
| **μ§€μ—° μ‹κ°„** | μ„λ²„μ—μ„ ν΄λΌμ΄μ–ΈνΈκΉμ§€μ μ „μ†΅ μ§€μ—° | RTP μ‹ν€€μ¤ λ²νΈμ™€ νƒ€μ„μ¤νƒ¬ν”„ λ¶„μ„ |
| **λ€μ—­ν­ μ‚¬μ©λ‰** | λ„¤νΈμ›ν¬ λ€μ—­ν­ μ†λ¨λ‰ | λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§ λ„κµ¬ μ‚¬μ© |
| **CPU μ‚¬μ©λ¥ ** | μ„λ²„ CPU μ‚¬μ©λ¥  | μ‹μ¤ν… λ¨λ‹ν„°λ§ λ„κµ¬ μ‚¬μ© |

### ν…μ¤νΈ μ‹λ‚λ¦¬μ¤

#### μ‹λ‚λ¦¬μ¤ 1: μ μ§„μ  λ¶€ν• ν…μ¤νΈ
1. 1κ° ν΄λΌμ΄μ–ΈνΈλ΅ μ‹μ‘
2. 5λ¶„λ§λ‹¤ 1κ°μ”© ν΄λΌμ΄μ–ΈνΈ μ¶”κ°€ (μµλ€ 20κ°)
3. κ° λ‹¨κ³„μ—μ„ 10λ¶„κ°„ μ•μ •μ„± ν…μ¤νΈ
4. ν¨ν‚· μ†μ‹¤λ¥ , μ§€ν„°, μ§€μ—° μ‹κ°„ κΈ°λ΅

#### μ‹λ‚λ¦¬μ¤ 2: μ¤νΈλ μ¤ ν…μ¤νΈ
1. 20κ° ν΄λΌμ΄μ–ΈνΈ λ™μ‹ μ ‘μ†
2. 30λ¶„κ°„ μ—°μ† μ†΅μ¶
3. λ„¤νΈμ›ν¬ ν’μ§ μ§€μ†μ  λ¨λ‹ν„°λ§
4. μ„λ²„ λ¦¬μ†μ¤ μ‚¬μ©λ¥  κ΄€μ°°

#### μ‹λ‚λ¦¬μ¤ 3: λ„¤νΈμ›ν¬ λ¶μ•μ • μ‹λ®¬λ μ΄μ…
1. λ„¤νΈμ›ν¬ μ§€μ—°/μ†μ‹¤ μ‹λ®¬λ μ΄μ… λ„κµ¬ μ‚¬μ©
2. λ‹¤μ–‘ν• λ„¤νΈμ›ν¬ μ΅°κ±΄μ—μ„ ν…μ¤νΈ
3. ν΄λΌμ΄μ–ΈνΈ μ¬μ—°κ²° λ¥λ ¥ ν™•μΈ

### λ¨λ‹ν„°λ§ λ° λ΅κΉ…

#### μ„λ²„ μΈ΅ λ¨λ‹ν„°λ§
```bash
# μ„λ²„ λ΅κ·Έμ—μ„ ν΄λΌμ΄μ–ΈνΈλ³„ ν†µκ³„ ν™•μΈ
tail -f backend.log | grep "RTP stats"

# μ‹μ¤ν… λ¦¬μ†μ¤ λ¨λ‹ν„°λ§
htop
iotop
```

#### ν΄λΌμ΄μ–ΈνΈ μΈ΅ λ¨λ‹ν„°λ§
- κ° ν΄λΌμ΄μ–ΈνΈλ” μμ‹ ν• RTP ν¨ν‚· μ, μ†μ‹¤λ¥ , μ§€ν„° μ •λ³΄λ¥Ό λ΅κ·Έλ΅ μ¶λ ¥
- μ£ΌκΈ°μ μΌλ΅ QoS λ©”νΈλ¦­μ„ μ„λ²„μ— μ „μ†΅ (`POST /qos-metrics`)

#### λ„¤νΈμ›ν¬ λ¨λ‹ν„°λ§
```bash
# λ„¤νΈμ›ν¬ νΈλν”½ λ¨λ‹ν„°λ§
iftop -i eth0
nethogs

# ν¨ν‚· μΊ΅μ² λ° λ¶„μ„
tcpdump -i eth0 -w capture.pcap
```

### QoS λ©”νΈλ¦­ μμ§‘ API

#### ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„ QoS λ°μ΄ν„° μ „μ†΅
```json
POST /qos-metrics
{
  "client_id": "client_001",
  "timestamp": "2024-01-01T12:00:00Z",
  "metrics": {
    "packets_received": 1500,
    "packets_expected": 1500,
    "packet_loss_rate": 0.0,
    "jitter_ms": 2.5,
    "latency_ms": 15.2,
    "bandwidth_mbps": 2.1
  }
}
```

#### μ„λ²„ μ‘λ‹µ
```json
{
  "status": "ok",
  "server_metrics": {
    "total_clients": 5,
    "total_packets_sent": 7500,
    "server_cpu_usage": 45.2,
    "server_memory_usage": 128.5
  }
}
```

### μ„±λ¥ λ©ν‘

| λ©”νΈλ¦­ | λ©ν‘κ°’ | μΈ΅μ • μ΅°κ±΄ |
|--------|--------|-----------|
| μµλ€ λ™μ‹ ν΄λΌμ΄μ–ΈνΈ | 20κ° | μ•μ •μ  μ†΅μ¶ |
| ν¨ν‚· μ†μ‹¤λ¥  | < 1% | μ •μƒ λ„¤νΈμ›ν¬ |
| μ§€ν„° | < 5ms | μ •μƒ λ„¤νΈμ›ν¬ |
| μ§€μ—° μ‹κ°„ | < 50ms | μ •μƒ λ„¤νΈμ›ν¬ |
| μ„λ²„ CPU μ‚¬μ©λ¥  | < 80% | 20κ° ν΄λΌμ΄μ–ΈνΈ |

### ν…μ¤νΈ κ²°κ³Ό λ¶„μ„

- **μ„±λ¥ κ·Έλν”„**: ν΄λΌμ΄μ–ΈνΈ μ vs κ°μΆ… λ©”νΈλ¦­ κ·Έλν”„ μƒμ„±
- **ν•κ³„μ  μ‹λ³„**: μ„±λ¥μ΄ κΈ‰κ²©ν μ €ν•λλ” μ§€μ  ν™•μΈ
- **μµμ ν™” λ°©μ•**: λ³‘λ© μ§€μ  λ¶„μ„ λ° κ°μ„  λ°©μ• λ„μ¶

## λ„¤νΈμ›ν¬ ν’μ§ λ¨λ‹ν„°λ§ λ° μ‹κ° λ™κΈ°ν™” (NTP)

- ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ™€μ μ •ν™•ν• latency(μ§€μ—°) μΈ΅μ •μ„ μ„ν•΄ **WebSocket κΈ°λ° NTP λ™κΈ°ν™”**λ¥Ό μν–‰ν•λ‹¤.
- ν‘μ¤€ NTP(UDP/123) λ€μ‹ , WebSocket λ©”μ‹μ§€λ΅ μ‹κ° λ™κΈ°ν™” λ° μ™•λ³µ μ§€μ—°(RTT) λ³΄μ •μ΄ κ°€λ¥ν•λ„λ΅ μ„¤κ³„ν•λ‹¤.
- λ™κΈ°ν™” κ³Όμ •μ—μ„ NTP ν”„λ΅ν† μ½μ ν•µμ‹¬(T1~T4, RTT, offset) κ³„μ‚°μ„ κ·Έλ€λ΅ μ μ©ν•λ‹¤.

### WebSocket κΈ°λ° NTP λ™κΈ°ν™” λ©”μ‹μ§€ μμ‹

ν΄λΌμ΄μ–ΈνΈ β†’ μ„λ²„:
```json
{
  "type": "ntp_request",
  "t1": 1721123456789
}
```
μ„λ²„ β†’ ν΄λΌμ΄μ–ΈνΈ:
```json
{
  "type": "ntp_response",
  "t1": 1721123456789,
  "t2": 1721123456790,
  "t3": 1721123456791
}
```
- t1: ν΄λΌμ΄μ–ΈνΈκ°€ μ”μ²­μ„ λ³΄λ‚Έ μ‹κ° (ms, UTC)
- t2: μ„λ²„κ°€ μ”μ²­μ„ μμ‹ ν• μ‹κ° (ms, UTC)
- t3: μ„λ²„κ°€ μ‘λ‹µμ„ λ³΄λ‚Έ μ‹κ° (ms, UTC)
- t4: ν΄λΌμ΄μ–ΈνΈκ°€ μ‘λ‹µμ„ μμ‹ ν• μ‹κ° (ms, UTC, ν΄λΌμ΄μ–ΈνΈμ—μ„ μΈ΅μ •)

### NTP μ¤ν”„μ…‹/μ§€μ—° κ³„μ‚° κ³µμ‹
```
round_trip_delay = (t4 - t1) - (t3 - t2)
offset = ((t2 - t1) + (t3 - t4)) / 2
```
- offsetμ„ ν΄λΌμ΄μ–ΈνΈ μ‹κ°μ— λ”ν•λ©΄ μ„λ²„ μ‹κ°κ³Ό λ™κΈ°ν™”λ¨
- round_trip_delay(RTT)κ°€ λ„λ¬΄ ν¬λ©΄(μ: 100ms μ΄μƒ) λ™κΈ°ν™” λ¬΄ν¨ μ²λ¦¬ κ°€λ¥

### RTP latency μΈ΅μ • ν™μ© μμ‹
- ν΄λΌμ΄μ–ΈνΈλ” NTP offsetμ„ μ μ©ν•΄ RTP ν¨ν‚· μμ‹  μ‹ latency(ms) κ³„μ‚° κ°€λ¥
- μ: `latency_ms = (client_receive_time_ms + offset) - server_rtp_timestamp_ms`
- μ •ν™•ν• latency, μ§€ν„°, ν¨ν‚· μ†μ‹¤λ¥  λ“± QoS λ©”νΈλ¦­ μ‚°μ¶μ— ν™μ©

### μ¥μ 
- λ³„λ„ UDP ν¬νΈ/μ‹μ¤ν… NTP μ„¤μ • μ—†μ΄, μ• ν”λ¦¬μΌ€μ΄μ… λ λ²¨μ—μ„ μ •ν™•ν• μ‹κ° λ™κΈ°ν™” κ°€λ¥
- WebSocket μ—°κ²°λ§μΌλ΅ μ‹¤μ‹κ°„ ν’μ§ λ¨λ‹ν„°λ§ λ° μλ™ν™”λ QoS λ¶„μ„ κ°€λ¥

## ν¨ν‚· μ²λ¦¬ λ° μ¤λ””μ¤ ν’μ§ μµμ ν™”

### ν¨ν‚· λ²„λ¦Ό vs λ³΄κ°„ μ „λµ

μ‹¤μ‹κ°„ μ¤λ””μ¤ μ‹μ¤ν…μ—μ„ ν¨ν‚· λ²„λ¦Όμ€ 'μ§€μ§' λ…Έμ΄μ¦λ¥Ό λ°μƒμ‹ν‚¬ μ μμΌλ―€λ΅ μ‹ μ¤‘ν• μ ‘κ·Όμ΄ ν•„μ”ν•©λ‹λ‹¤.

#### 1. λ³΄κ°„(Interpolation) κΈ°λ° ν¨ν‚· λ³µκµ¬
- μ΄μ „ ν¨ν‚·κ³Ό λ‹¤μ ν¨ν‚· μ‚¬μ΄λ¥Ό λ³΄κ°„ν•μ—¬ λ„λ½λ μ¤λ””μ¤ λ°μ΄ν„° λ³µκµ¬
- μ €μ£Όν μ„±λ¶„μ€ λ³΄κ°„μ΄ ν¨κ³Όμ , κ³ μ£Όν μ„±λ¶„μ€ λ³΄κ°„ μ‹ μ•„ν‹°ν©νΈ λ°μƒ κ°€λ¥
- ν¨ν‚· λ²„λ¦Όλ³΄λ‹¤ μμ—°μ¤λ¬μ΄ μ¤λ””μ¤ μ¬μƒ κ°€λ¥

#### 2. μ μ‘ν• λ²„νΌλ§
- μ§€ν„° μμ¤€μ— λ”°λΌ λ™μ μΌλ΅ λ²„νΌ ν¬κΈ°λ¥Ό μ΅°μ •
- λ‚®μ€ μ§€ν„°: μ‘μ€ λ²„νΌλ΅ λ‚®μ€ μ§€μ—° μ μ§€
- λ†’μ€ μ§€ν„°: ν° λ²„νΌλ΅ μ•μ •μ„± ν™•λ³΄
- μ‹¤μ‹κ°„ λ„¤νΈμ›ν¬ μƒν™©μ— μ μ‘

#### 3. μ§€ν„° μ„κ³„κ°’ κΈ°λ° μ²λ¦¬
- μ§€ν„° μ„κ³„κ°’μ€ μ‹μ¤ν… ν™κ²½μ— λ”°λΌ νλ‹μ΄ ν•„μ”ν•λ©°, SQLiteμ— ν•„λ“λ΅ μ €μ¥ν•΄ APIλ΅ κ΄€λ¦¬ν•  μ μμµλ‹λ‹¤.
- μμ‹:
```rust
// μ§€ν„° μ„κ³„κ°’ (SQLiteμ—μ„ κ΄€λ¦¬)
const JITTER_INTERPOLATE_THRESHOLD: u32 = 100;  // 100ms: λ³΄κ°„ μ‹μ‘
const JITTER_DROP_THRESHOLD: u32 = 200;         // 200ms: ν¨ν‚· λ²„λ¦Ό
```

### μ¤λ””μ¤ μ£Όνμ λ¶„μ„ λ° EQ μ²λ¦¬μ μ§€μ—° μν–¥

- μ €μ£Όν/κ³ μ£Όν κµ¬λ¶„μ΄λ‚ EQ μ²λ¦¬λ¥Ό μ„ν•΄ FFT(κ³ μ† ν‘Έλ¦¬μ— λ³€ν™)λ¥Ό μ‚¬μ©ν•  μ μμµλ‹λ‹¤.
- FFTλ” μ‹¤μ‹κ°„ μ¤λ””μ¤ μ²λ¦¬μ—μ„ μ•½κ°„μ μ¶”κ°€ μ§€μ—°(μλ°± λ§μ΄ν¬λ΅μ΄~1ms λ‚΄μ™Έ)μ„ μ λ°ν•  μ μμµλ‹λ‹¤.
- EQ μ—­μ‹ μ‹¤μ‹κ°„ μ²λ¦¬κ°€ κ°€λ¥ν•μ§€λ§, λ³µμ΅ν• ν•„ν„°λ‚ κ³ μ°¨ FFTλ¥Ό μ‚¬μ©ν•  κ²½μ° λ„μ  μ§€μ—°μ΄ λ°μƒν•  μ μμΌλ―€λ΅, μ‹μ¤ν…μ μ‹¤μ‹κ°„μ„± μ”κµ¬μ‚¬ν•­μ— λ”°λΌ μ μ© λ²”μ„λ¥Ό κ²°μ •ν•΄μ•Ό ν•©λ‹λ‹¤.
- μ‹¤μ‹κ°„μ„±μ΄ λ§¤μ° μ¤‘μ”ν• κ²½μ°, FFT/EQ μ μ© κµ¬κ°„μ„ μµμ†ν™”ν•κ±°λ‚, μ €μ§€μ—° μµμ ν™”λ μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•λ” κ²ƒμ΄ κ¶μ¥λ©λ‹λ‹¤.

## RTP ν—¤λ” Extensionμ„ ν™μ©ν• μ‹κ° λ™κΈ°ν™”

### RTP Extension ν—¤λ” κµ¬μ΅°

μ‹¤μ‹κ°„ μ¤λ””μ¤ μ¤νΈλ¦¬λ°μ—μ„ μ •ν™•ν• latency μΈ΅μ •μ„ μ„ν•΄ RTP ν—¤λ” Extensionμ„ ν™μ©ν•©λ‹λ‹¤.

#### Extension ν—¤λ” κµ¬μ΅° (RFC3550ν‘μ¤€)
```rust
struct RtpExtension [object Object]
    profile: u16,        //0BEDE (ν‘μ¤€ ν”„λ΅νμΌ)
    length: u16,         // Extension λ°μ΄ν„° κΈΈμ΄ (μ›λ“ λ‹¨μ„)
    server_time_ms: u64, // μ„λ²„ UTC μ‹κ° (ms)
    event_flags: u8    // μ΄λ²¤νΈ ν”λκ·Έ
    reserved:u8;3],   // μμ•½λ λ°”μ΄νΈ
}
```

#### μ£ΌκΈ°μ  Extension μ „μ†΅
- **5μ΄λ§λ‹¤** RTP ν¨ν‚·μ— Extension ν—¤λ” ν¬ν•¨
- μΌλ° ν¨ν‚·μ€ Extension μ—†μ΄ μ „μ†΅ν•μ—¬ μ¤λ²„ν—¤λ“ μµμ†ν™”
- ν΄λΌμ΄μ–ΈνΈλ” Extension ν”λκ·Έ(X=1μ‹κ° λ™κΈ°ν™” ν¨ν‚· κµ¬λ¶„

#### RTP ν¨ν‚· κµ¬μ΅°
```κΈ°λ³Έ RTP ν—¤λ” 12μ΄νΈ] +Extension ν—¤λ”16 + [μ¤λ””μ¤ λ°μ΄ν„°]
```

### ν΄λΌμ΄μ–ΈνΈμ—μ„μ μ²λ¦¬

#### Extension ν—¤λ” νμ‹±
```rust
// RTP ν—¤λ”μ—μ„ Extension ν”λκ·Έ ν™•μΈ
if (rtp_header[0& 0x10) != 0 [object Object]    // Extension ν—¤λ” νμ‹±
    let server_time_ms = parse_extension_header(&rtp_packet[12..28]);
    let latency = (client_time_ms + ntp_offset) - server_time_ms;
    println!("[RTP] Extension: server_time=[object Object]ency=[object Object]s, server_time_ms, latency);
}
```

#### μ¥μ 
- **κΈ°μ΅΄ RTP ν‘μ¤€ μ¤€μ**: RFC3550 Extension ν—¤λ” ν™μ©
- **μ£ΌκΈ°μ  μ „μ†΅**: 5λ§λ‹¤λ§ Extension ν¬ν•¨ν•μ—¬ μ¤λ²„ν—¤λ“ μµμ†ν™”
- **μ •ν™•ν• μ‹κ° λ™κΈ°ν™”**: μ„λ²„ μ†΅μ‹  μ‹κ°μ„ μ§μ ‘ μ „λ‹¬ν•μ—¬ latency κ³„μ‚° μ •ν™•λ„ ν–¥μƒ
- **WebSocket λ…λ¦½**: RTP μ¤νΈλ¦Ό λ‚΄μ—μ„ μ‹κ° λ™κΈ°ν™” μ²λ¦¬

#### Extension μ΄λ²¤νΈ ν”λκ·Έ
| ν”λκ·Έ κ°’ | μλ―Έ |
|-----------|------|
| 0x1 | time_sync (μ‹κ° λ™κΈ°ν™”) |
| 0x2 | status_update (μƒνƒ μ—…λ°μ΄νΈ) |
| 0x04 | control_message (μ μ–΄ λ©”μ‹μ§€) |

### κµ¬ν„ μμ‹

#### μ„λ²„ μΈ΅ (RTP μ†΅μ‹ )
```rust
let mut extension_counter =0extension_interval =250 // 5 = 250κ° ν¨ν‚· (20ms κ°„κ²©)

if extension_counter % extension_interval == 0 [object Object]    // Extension ν—¤λ” ν¬ν•¨
    let extension = RtpExtension [object Object]
        profile: 0xBEDE,
        length: 323       server_time_ms: chrono::Utc::now().timestamp_millis() as u64,
        event_flags: 001, // time_sync ν”λκ·Έ
        reserved: [0;3],
    };
    // RTP ν¨ν‚·μ— Extension μ¶”κ°€
} else [object Object]    // μΌλ° RTP ν¨ν‚· (Extension μ—†μ)
}
```

#### ν΄λΌμ΄μ–ΈνΈ μΈ΅ (RTP μμ‹ )
```rust
// RTP ν—¤λ” νμ‹±
let has_extension = (rtp_header[0 & 0x10

if has_extension [object Object]    // Extension ν—¤λ” νμ‹± (12-28λ°”μ΄νΈ)
    let server_time_ms = u64::from_be_bytes([
        rtp_packet[12], rtp_packet[13], rtp_packet[14, rtp_packet[15        rtp_packet[16], rtp_packet[17], rtp_packet[18], rtp_packet[19]
    ]);
    
    let client_time_ms = chrono::Utc::now().timestamp_millis() as u64;
    let (ntp_offset, _) = *ntp_state.lock().unwrap();
    let latency = (client_time_ms + ntp_offset) - server_time_ms;
    
    println!("[RTP] Extension sync: server={}, client=[object Object], latency={}ms", 
             server_time_ms, client_time_ms, latency);
}
```

## ν΄λΌμ΄μ–ΈνΈμ μ§€ν„° μ„κ³„κ°’ μ μ© μ •μ±…

- **μ§€ν„° μ„κ³„κ°’(Jitter Threshold)μ€ ν΄λΌμ΄μ–ΈνΈμ—μ„ μ μ©**ν•λ©°, μ„λ²„λ” κΈ°λ³Έκ°’μ„ μ κ³µ(API: `/jitter-thresholds`).
- ν΄λΌμ΄μ–ΈνΈλ” λ‹¤μ μ°μ„ μμ„λ΅ μ„κ³„κ°’μ„ κ²°μ •:
    1. **ν™κ²½λ³€μ**(`JITTER_INTERPOLATE_MS`, `JITTER_DROP_MS`)κ°€ μ„¤μ •λμ–΄ μμΌλ©΄ μ΄λ¥Ό μ°μ„  μ‚¬μ©
    2. ν™κ²½λ³€μκ°€ μ—†μΌλ©΄ μ„λ²„μ `/jitter-thresholds` APIμ—μ„ κΈ°λ³Έκ°’μ„ λ°›μ•„ μ‚¬μ©
    3. μ„λ²„ APIλ„ μ‹¤ν¨ν•λ©΄ μ½”λ“ λ‚΄ κΈ°λ³Έκ°’(100ms/200ms)μ„ μ‚¬μ©
- μ΄ κµ¬μ΅°λ΅ "ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μ„¤μ •ν•μ§€ μ•μΌλ©΄ μ„λ²„μ κΈ°λ³Έκ°’μ„ λ”°λ¥Έλ‹¤"λ” μ •μ±…μ΄ κµ¬ν„λ¨
- (EQ, FFT λ“± μ¤λ””μ¤ ν’μ§ κ΄€λ ¨ μ„¤μ •λ„ ν΄λΌμ΄μ–ΈνΈμ—μ„ κ°λ³„μ μΌλ΅ μ μ© κ°€λ¥)

### μ§€ν„° μ„κ³„κ°’ REST API

#### GET /jitter-thresholds
- μ„λ²„μ μ§€ν„° μ„κ³„κ°’(λ³΄κ°„/λ²„λ¦Ό κΈ°μ¤€)μ„ μ΅°ν
- μ‘λ‹µ μμ‹:
```json
{
  "interpolate": 100,
  "drop": 200
}
```

#### POST /jitter-thresholds
- μ„λ²„μ μ§€ν„° μ„κ³„κ°’(λ³΄κ°„/λ²„λ¦Ό κΈ°μ¤€)μ„ κ°±μ‹ 
- μ”μ²­ μμ‹:
```json
{
  "interpolate": 120,
  "drop": 250
}
```
- μ‘λ‹µ μμ‹:
```json
{
  "status": "ok"
}
```

#### ν΄λΌμ΄μ–ΈνΈμ μ§€ν„° μ„κ³„κ°’ μ„λ²„ μμ‹  κ·κ²© λ° λ™μ‘ νλ¦„

- ν΄λΌμ΄μ–ΈνΈλ” μ‹¤ν–‰ μ‹ μ„λ²„μ `/jitter-thresholds` REST APIλ¥Ό νΈμ¶ν•μ—¬ μ§€ν„° μ„κ³„κ°’(λ³΄κ°„/λ²„λ¦Ό κΈ°μ¤€)μ„ λ°›μ•„μµλ‹λ‹¤.
- μ„λ²„ μ‘λ‹µ(JSON):
```json
{
  "interpolate": 100,
  "drop": 200
}
```
- ν΄λΌμ΄μ–ΈνΈλ” ν™κ²½λ³€μ(`JITTER_INTERPOLATE_MS`, `JITTER_DROP_MS`)κ°€ μ—†μ„ κ²½μ° μ΄ κ°’μ„ μ‚¬μ©ν•©λ‹λ‹¤.
- μμ‹ Rust μ½”λ“:
```